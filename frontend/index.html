<!DOCTYPE html>
<html lang="en">
<head>
    <title>Pokedex</title>
    <link rel="stylesheet" href="./css/index.css">
</head>
<body>
    <section class="search-area">
        <form class="search-form">
            <input class="search-input" type="text" name="name" placeholder="pokemon name" height="30px">
            <div class="search-button">GO!</button>
        </form>
    </section>
    <section class="display-area">
        <div class="card">
            <!-- BIG CARD CREATED DINAMICALLY HERE -->
        </div>
        <div class="card-deck">
            <!-- DECK OF SMALL CARDS CREATED DINAMICALLY HERE -->
        </div>
    </section>

    <script>
        let range = 30;
        const card = document.querySelector(".card");
        const pokeForm = document.querySelector(".search-form input");
        const titleInput = document.querySelector(".dex-title");
        const typesInput = document.querySelector(".dex-types");
        const spriteInput = document.querySelector(".dex-sprite");
        const cardDeck = document.querySelector(".card-deck");
        const button = document.querySelector(".search-button");
        const missingno = {
            id: 0,
            name: "missingno",
            icon: "./css/assets/icons/unknown.png",
            sprite: "./css/assets/missingno.png",
            types: ["unknown"]
        }
        colorType = {
            normal: "A8A77A",
            fire: "EE8130",
            water: "6390F0",
            electric: "F7D02C",
            grass: "7AC74C",
            ice: "96D9D6",
            fighting: "C22E28",
            poison: "A33EA1",
            ground: "E2BF65",
            flying: "A98FF3",
            psychic: "F95587",
            bug: "A6B91A",
            rock: "B6A136",
            ghost: "735797",
            dragon: "6F35FC",
            dark: "705746",
            steel: "B7B7CE",
            fairy: "D685AD",
            unknown: "000000"
        }
        
        const createBigCard = (obj) => {
            console.log(`Hora de criar meu Big Card. Entrei em createBigCard e recebi o seguinte obj:`)
            console.log(obj)
            card.innerHTML = "";

            // !!!!!!!! SEE CARD SCTRUCTURE BELOW !!!!!!!!
            /*
            <div class="card">
                <div class="content-container">
                    <div class="dex-title">
                        <!-- NAME -->
                    </div>
                    <div class="dex-types">
                        <!-- TYPE IMG(S) -->
                    </div>
                </div>
                <div class="dex-sprite">
                <!-- SPRITE -->
                </div>
            </div>
            */
            
            let newContentContainer = document.createElement('div')
            let newDexTitle = document.createElement('div')
            let newDexTypes = document.createElement('div')
            let newDexSprite = document.createElement('div')
            
            newContentContainer.className = "content-container"
            newDexTitle.className = "dex-title"
            newDexTypes.className = "dex-types"
            newDexSprite.className = "dex-sprite"

            newDexTitle.innerHTML = obj.name
            newContentContainer.appendChild(newDexTitle)

            let newSprite;
            for (let i = 0; i < obj.types.length ; i++) {
                newSprite = document.createElement('img')
                if (obj.types[i] === "unknown") { newSprite.src = "./css/assets/icons/unknown.png" }
                else { newSprite.src = `./css/assets/icons/${obj.types[i]}_en.png` }
                newSprite.style.height = '25px'
                newDexTypes.appendChild(newSprite);
            }
            newContentContainer.appendChild(newSprite)
            card.appendChild(newContentContainer)

            newSprite = document.createElement('img')
            newSprite.src = `${obj.sprite}`
            newSprite.style.height = "200px"
            card.appendChild(newSprite)

            card.style.backgroundColor = `#${colorType[obj.types[0]]}`;
            card.style.display = "flex";
        }

        const createSmallCard = (obj) => {
            let newCardBody = document.createElement('div')
            let cardID = document.createElement('h1')
            let cardSprite = document.createElement('img')
            
            newCardBody.className = "small-card"
            cardID.innerHTML = obj.id
            cardID.style.margin = "0px"
            cardSprite.className = "img"
            cardSprite.src = obj.sprite
            
            newCardBody.appendChild(cardID);
            newCardBody.appendChild(cardSprite);
            
            return newCardBody
        }

        async function getSingleCard (event) {
            event.preventDefault();
            let success = true;
            const pokemon = pokeForm.value.toLowerCase();
            await fetch(`http://localhost:5000/newsearch?name=${pokemon}`)
            .then(res => res.json())
            .then(obj => {
                if (obj === "oops") {
                    console.log('Got an "oops" error from the backend ==> Load MISSIGNO')
                    createBigCard(missingno)
                }
                else { createBigCard(obj) }
            })
            card.style.display = "flex";
        }

        async function getDeckList (targetURL) {
            await fetch(targetURL)
            .then(res => res.json())
            .then(obj => {  //recebe um array de novos pkms a serem adicionados ao deck
                if (obj != "oops"){
                    obj = obj[0];
                    obj.forEach( el => { cardDeck.appendChild(createSmallCard(el)) })
                    // createSmallCard(obj[0])
                }
            })
        }


        getDeckList(`http://localhost:5000/carddeck?offset=0&range=${range}`);  //ON PAGE LOAD => INITIAL DECK

        button.addEventListener("click", getSingleCard);


        // FORM CLICKER ==> HITTING ENTER WHILE TYPING A POKEMON WILL CLICK THE "GO!" BUTTON
        pokeForm.addEventListener("keydown", function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                button.click();
                pokeForm.value="";
            }
        });
        </script>
    </body>
</html>