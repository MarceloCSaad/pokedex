<!DOCTYPE html>
<html lang="en">
<head>
    <title>Pokedex</title>
    <link rel="stylesheet" href="./css/index.css">
</head>
<body>
    <section class="search-area">
        <form class="search-form">
            <input class="search-input" type="text" name="name" placeholder="pokemon name" height="30px">
            <div class="search-button">GO!</button>
        </form>
    </section>
    <section class="display-area">
        <div class="card">
            <div class="content-container">
                <div class="dex-title">
                    <!-- NAME -->
                </div>
                <div class="dex-types">
                    <!-- TYPE(S) -->
                </div>
            </div>
            <div class="dex-sprite">
            <!-- SPRITE -->
            </div>
        </div>
        <div class="card-deck">
            <!-- SMALL CARDS DECK HERE -->
        </div>
    </section>

    <script>
        let range = 30;
        let deck = [];
        const card = document.querySelector(".card");
        const pokeForm = document.querySelector(".search-form input");
        const titleInput = document.querySelector(".dex-title");
        const typesInput = document.querySelector(".dex-types");
        const spriteInput = document.querySelector(".dex-sprite");
        const cardDeck = document.querySelectorAll(".card-deck");
        const button = document.querySelector(".search-button");
        colorType = {
            normal: "A8A77A",
            fire: "EE8130",
            water: "6390F0",
            electric: "F7D02C",
            grass: "7AC74C",
            ice: "96D9D6",
            fighting: "C22E28",
            poison: "A33EA1",
            ground: "E2BF65",
            flying: "A98FF3",
            psychic: "F95587",
            bug: "A6B91A",
            rock: "B6A136",
            ghost: "735797",
            dragon: "6F35FC",
            dark: "705746",
            steel: "B7B7CE",
            fairy: "D685AD"
        }
        
        const createBigCard = (event) => {
            event.preventDefault();
            let typeImg = "";
            const pokemon = pokeForm.value.toLowerCase();
            fetch(`http://localhost:5000/newsearch?name=${pokemon}`)
            .then(res => res.json())
            .then(obj => {      //now we have the pokemon card object, straight from our API!
                let typeImg = "";
                if (obj !== undefined && obj !== "oops") {
                    for (let i = 0; i < obj.types.length ; i++) {
                        typeImg = typeImg + `<img src="./css/assets/icons/${obj.types[i]}_en.png" height="25px">`;
                    }
                    titleInput.innerHTML = `${obj.name}`;  //Title
                    typesInput.innerHTML = typeImg;  // Types
                    spriteInput.innerHTML = `<img src="${obj.sprite}" height="200px">`;  // Sprite
                    card.style.backgroundColor = `#${colorType[obj.types[0]]}`;
                } else {    //If fetch gives me an undefined or "oops" error, then load missingno
                    titleInput.innerHTML = "missingno";  //Title
                    typesInput.innerHTML = `<img src="./css/assets/icons/unknown.png" height="25">`;  // Types
                    spriteInput.innerHTML = `<img src="./css/assets/missingno.png" height="200px">`;  // Sprite
                    card.style.backgroundColor = `#000000`;
                }
                    card.style.display = "flex";
            })
        }
        
        async function getDeckList (targetURL) {
            await fetch(targetURL)
            .then(res => res.json())
            .then(obj => {  //recebe um array de novos pkms a serem adicionados ao deck
                if (obj != "oops"){
                    obj = obj[0];
                    cardDeck[0].innerHTML = createSmallCard (obj[0])
                    // createSmallCard(obj[0])
                }
            })
        }

        const createSmallCard = (obj) => {
            return `<div class="small-card"><h1>${obj.id}</h1> <img src="${obj.sprite}"></div>`;
        }


        getDeckList(`http://localhost:5000/carddeck?offset=0&range=${range}`);

        button.addEventListener("click", createBigCard);

        pokeForm.addEventListener("keydown", function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                button.click();
                pokeForm.value="";
            }
        });
        

    </script>
</body>
</html>